@model recruitingWebApp.Models.User

@{
    ViewData["Title"] = "Your Profile";
}

<h2>Your Profile</h2>

@if (Model != null)
{
    <div class="card" style="width: 22rem; margin: 20px auto; text-align: center; padding: 20px;">
        @if (Model.ProfileImage != null && Model.ProfileImage.ImageData != null)
        {
            <img class="rounded-circle" src="data:image/png;base64,@Convert.ToBase64String(Model.ProfileImage.ImageData)" alt="Profile Picture" style="width: 150px; height: 150px; object-fit: cover; margin-bottom: 15px;" />
        }

        <form asp-action="UpdateProfilePic" asp-controller="Home" method="post" enctype="multipart/form-data" style="margin-top: 10px;">
            <input type="hidden" name="UserId" value="@Model.Id" />
            <input type="file" name="file" accept="image/*" required class="form-control mb-2" />
            <button type="submit" class="btn btn-primary">Change Profile Picture</button>
        </form>

        <div class="card-body">
            <h3 class="card-title">@Model.FirstName @Model.LastName</h3>
            <p class="text-muted">@Model.Username</p>
            <p class="card-text">@(!string.IsNullOrEmpty(Model.Bio) ? Model.Bio : "No bio")</p>
        </div>

        <hr>
        <h5>Posts</h5>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPostModal" style="margin-top: 10px;">
            +
        </button>

        <div class="mt-3">
            @if (Model.Posts != null && Model.Posts.Any())
            {
                @foreach (var post in Model.Posts.OrderByDescending(p => p.Timestamp))
                {
                    <div class="card mt-3 text-start">
                        <div class="card-body">
                            <p class="card-text">@post.Caption</p>

                            @if (post.ContentType.StartsWith("video"))
                            {
                                <video class="w-100 mb-2" controls>
                                    <source src="@post.PostUrl" type="@post.ContentType">
                                    Your browser does not support the video tag.
                                </video>
                            }
                            else
                            {
                                <img src="@post.PostUrl" class="img-fluid mb-2" alt="User post image" />
                            }
                            <p class="text-muted" style="font-size: 0.85rem;">Posted on @post.Timestamp.ToLocalTime().ToString("g")</p>
                        </div>
                    </div>
                }
            }
            else
            {
                <p class="text-muted mt-2">No posts yet.</p>
            }
        </div>
    </div>
}
else
{
    <p>User not found.</p>
}


<div class="modal fade" id="addPostModal" tabindex="-1" aria-labelledby="addPostModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content p-3">
            <form asp-controller="User" asp-action="AddPost" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="Caption" class="form-label">Caption</label>
                    <input type="text" class="form-control" name="Caption" id="Caption" maxlength="300" />
                </div>

                <div class="mb-3">
                    <label for="file" class="form-label">Upload Video or Image</label>
                    <input type="file" class="form-control" name="file" id="file" accept="video/*,image/*" />
                </div>

                <button type="submit" class="btn btn-primary w-100">Post</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
